---
knit: (function(input_file, encoding) {
  out_dir <- 'docs/R';
  rmarkdown::render(input_file,
    encoding=encoding,
    output_file='chi-sq-test.md') })
output: github_document
editor_options:
  chunk_output_type: console
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,
                      fig.path = "img/chi-sq-test/",
                      fig.width = 6, fig.height = 4,
                      fig.show = 'hold', fig.align = 'center')
options(width = 100)
```

# The Chi-square (&chi;<sup>2</sup>) Test

&emsp;When our data includes two categorical variables, we can determine if there is a statistically significant relationship (or alternatively dependence) between them with the &chi;<sup>2</sup> test. WIth the &chi;<sup>2</sup> test, we compare the observed counts (our data) with the expected counts if the data came from the same distributions.

&emsp;For this tutorial we will use data from an example offered in [STAT 500 Applied Statistics](https://online.stat.psu.edu/stat500/lesson/8) where participants were asked to give their party affiliation (*Democrat* or *Republican*) and their opinion on a tax reform bill (*Favor*, *Indifferent*, or *Opposed*).

<div align="center">

| | Favor | Indifferent | Opposed |
| :--- | :---: | :---: | :---: |
| **Democrat** | 138 | 83 | 64 |
| **Republican** | 64 | 67 | 84 |

</div>

&emsp;The researcher wants to know whether a relationship exists between party affiliation and opinion which corresponds to the following statistical hypotheses:

<center><i>H<sub>0</sub></i>: No relationship exists between party affiliation and opinion on the tax reform bill</center>
<center><i>H<sub>A</sub></i>: There is a significant relationship between party affiliation and opinion on the tax reform bill</center>

### [Assumptions and considerations](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3900058/)

&emsp;Before using the &chi;<sup>2</sup> test to test association (or independence) we should make sure we meet the following conditions:

* The data is in non-transformed frequencies or counts
* Each level is mutually exclusive
* Each subject or observation can only contribute data once
* The expected value should be 5 or more for at least 80% of the cells and none should be < 1
* No cells in the observations table should be 0

&emsp;When either of the last two conditions are not satisfied then you may consider a Fisher-exact test.

### Run the &chi;<sup>2</sup> test

&emsp;Using the `data.frame()` function we can easily code the data from the above table into R going from top to bottom row-wise then left to right column-wise.  By putting the variable name before the `=` in each line we can set the desired names for each column then set the `row.names` option to add the desired names to the rows.

```{r build_table}
opinion <- data.frame(Favor = c(138, 64),
                      Indifferent = c(83, 67),
                      Opposed = c(64, 84),
                      row.names = c("Democrat", "Republican"))

opinion
```

&emsp;Now that we have our data in a table we can run the &chi;<sup>2</sup> test by simply using the `chisq.test()` function on our data frame.

```{r chisq_test}
chisq.test(opinion)
```

&emsp;The output of the `chisq.test()` function gives us the test statistic (`X-squared = 22.152`), the degrees of freedom (`df = 2`), and the p-value associated with the test statistics (`p-value = 1.548e-05`). Importantly for answering our original question, the p-value is much less than 0 so that we can conclude that an association does exist between party affiliation and a person's opinion on the tax reform bill.

<table>
<tr><th>Observed </th><th>Expected</th></tr>
<tr><td>

| | Favor | Indifferent | Opposed | Total |
| :--- | :---: | :---: | :---: | :---: |
| **Democrat** | 138 | 83 | 64 | 285 |
| **Republican** | 64 | 67 | 84 | 215 |
| **Total** | 202 | 150 | 148 | 500 |

</td><td>

| | Favor | Indifferent | Opposed |
| :--- | :---: | :---: | :---: |
| **Democrat** | 115.14 | 85.5 | 84.36 |
| **Republican** | 86.86 | 64.5 | 63.64 |

</td></tr> </table>

&emsp;Comparing the observed and expected counts tables we can see that respondents who identified as *Republican* had more *Opposed* responses than expected compared to those who identified as *Democrat*, who also had more responses for *Favor*.  The observed and expected counts almost match for the *Indifferent* responses from both parties.
