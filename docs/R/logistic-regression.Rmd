---
knit: (function(input_file, encoding) {
  out_dir <- 'docs/R';
  rmarkdown::render(input_file,
    encoding=encoding,
    output_file='logistic-regression.md') })
output: github_document
editor_options:
  chunk_output_type: console
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, fig.path="img/logistic-regression/",
                      fig.width=6, fig.height=4,
                      fig.show='hold', fig.align='center')
options(width=100)
```

# Logistic (Logit) Regression

### Load the data

&nbsp;&nbsp;&nbsp;&nbsp;Here, we will use a dataset provided in [STAT 501 Regression Methods](https://online.stat.psu.edu/stat501/lesson/15/15.1) that looks at factors that may predict Leukemia remission. To do so, we can use the `read.table()` command with the pathway to where we put our file. Because of how the file is encoded, we will need to also add the `fileEncoding = "UCS-2LE"` and `header = TRUE` options to properly load the dataset into R.

```{r}
remiss <- read.table("dat/leukemia_remission.txt",
                     fileEncoding = "UCS-2LE", header = TRUE)
```

### Fit a binary logistic regression model

Now that we have our dataset we can simply fit a logistic regression model with the `glm()` function where we set up our model formula with the response variable, *REMISS*, to the left and the predictor variables to the right of a *~*. Instead of writing out all of our predictor variables we can instead choose to use a "." which will call add all of the variables to the model. Finally, after filling out the `data =` argument we need to set `family = binomial` to fit a logistic regression model, otherwise `glm()` would default to fitting a linear model.

```{r}
remiss.fit <- glm(REMISS ~ ., data = remiss, family = binomial)
```

### Interpret the results

Like any other model fit by the `glm()` function we can use the `summary()` command to see a summary of the results of the fit.

```{r}
summary(remiss.fit)
```

From the p-values for the Walds tests on the estimated coefficients are listed in the `Pr(>|z|)` column, from where we can see that none of the variables are significant predictors in this model. Unlike in the Minitab output provided in the STAT 510 notes, the base `summary()` function in R does not provide variance inflation factors (VIFs). While we could use a package to calculate the VIFs for this model, we will instead go ahead and refit our model with only one predictor.

### Refit a simpler model

Instead of writing a new formula in `glm()` as above, the `update()`  function provides a simpler way to refitting models. To keep variables in the updated model we use the "." and to add or remove variables we can use "-" and "+" or "*" for interactions.

```{r}
remiss.fit2 <- update(remiss.fit, .~LI)

summary(remiss.fit2)
```

In the summary from our refit model, we see that when *LI* is the only predictor its estimated coefficient is statistically significant with a p-value below 0.05. Keep in mind that the interpretation of the coefficient is different from linear regression. Specifically for our example, we could conclude that for every 1 unit increase in the *LI* variable the log odds of predicting *REMISS* increases by 2.897. This type of interpretation will not be very meaningful for many applications, but the important information to take away here is that *LI* is a significant predictor of *REMISS* for which they share some positive relationship.

### Full code block

```{r eval = FALSE}
# Load the data
remiss <- read.table("dat/leukemia_remission.txt",
                     fileEncoding = "UCS-2LE", header = TRUE)

# Fit a binary logistic regression model including all the variables
remiss.fit <- glm(REMISS ~ ., data = remiss, family = binomial)

# Summarize the results of the full model
summary(remiss.fit)

# Fit a new logistic regression model with only the Leukemia Index (LI) variable
remiss.fit2 <- glm(REMISS ~ LI, data = remiss, family = binomial)

# Summarize the results of the simple model
summary(remiss.fit2)
```

```{r eval = FALSE, echo = FALSE}
plot(remiss$LI, remiss$REMISS, pch = 19, col = "steelblue",
     xlab = "Percentage labeling index of the bone marrow leukemia cells (LI)",
     ylab = "Probability of leukemia remission (REMISS)",
     main = "Line plot of the fitted binary logistic regression model")
LI <- remiss$LI
curve(predict(remiss.fit2, data.frame(LI=x), type="resp"), add = TRUE,
      col = "tomato", lwd = 2)
```

